\hypertarget{a00026}{
\section{Package advection}
\label{a00026}\index{advection@{advection}}
}
Module orchestrating the \hyperlink{a00026}{advection} scheme. The main routine in the module is advection().  


\subsection*{Functions/Subroutines}
\begin{CompactItemize}
\item 
subroutine \hyperlink{a00026_4dbccca3daf30ad5f7c82915361a78f7}{advect} (mass, mass\_\-prev, flow, flow\_\-lo, flow\_\-hi, area, area\_\-prev, area\_\-lo, area\_\-hi, ncell, nvar, time, dt, dx)
\begin{CompactList}\small\item\em Integrate \hyperlink{a00026}{advection} plus sources for a time step. The final argument to advect is a callback for computing the source term, which should conform to the \hyperlink{a00036}{source\_\-if} interface The algoritm looks like this:\begin{itemize}
\item Convert to primitive variables\item Extrapolate to faces\begin{itemize}
\item difference()\item limiter()\item \hyperlink{a00026_36ba824cb5dc6ca6127866376d2e79ec}{extrapolate()}\end{itemize}
\item upwind()\item \hyperlink{a00026_3947a8a29b1c666b2d1b7223215e9873}{compute\_\-flux()}\item \hyperlink{a00026_ce0b27ec0ac171c15a919d07fb3b32c3}{replace\_\-boundary\_\-flux()} for boundary and special cases\item Compute conservative divergence\item Apply divergence in conservative\_\-update along with Huen's method for sources Note that all these steps are operations on entire arrays of values -- this keeps things efficient. \end{itemize}
\item\end{CompactList}\item 
subroutine \hyperlink{a00026_36ba824cb5dc6ca6127866376d2e79ec}{extrapolate} (conc\_\-lo, conc\_\-hi, conc, grad, source, flow, area, ncell, nvar, time, dt, dx)
\begin{CompactList}\small\item\em Extrapolate primitive data from cell center at the old time to cell edges at the half time. The extrapolation is done by a Taylor series in time and space in which an explicit discretization of the PDE is used to represent the time part. \item\end{CompactList}\item 
subroutine \hyperlink{a00026_3947a8a29b1c666b2d1b7223215e9873}{compute\_\-flux} (flux\_\-lo, flux\_\-hi, conc\_\-lo, conc\_\-hi, flow\_\-lo, flow\_\-hi, ncell, nvar)
\begin{CompactList}\small\item\em Compute the upwinded fluxes The calculation here does not include tributaries, boundaries or special objects. \item\end{CompactList}\item 
subroutine \hyperlink{a00026_aa34a3af6ce02dba4b6a11c1b38f51f0}{compute\_\-divergence} (div\_\-flux, flux\_\-lo, flux\_\-hi, ncell, nvar)
\begin{CompactList}\small\item\em Compute the divergence of fluxes. At present, this is undivided...which may be not what we want. \item\end{CompactList}\item 
subroutine \hyperlink{a00026_ce0b27ec0ac171c15a919d07fb3b32c3}{replace\_\-boundary\_\-flux} (flux\_\-lo, flux\_\-hi, conc\_\-lo, conc\_\-hi, flow\_\-lo, flow\_\-hi, ncell, nvar, time, dt, dx)
\begin{CompactList}\small\item\em Replace original calculated flux at boundary locations todo: figure out if the arguments are right and move this routine to the application -- it should just be an interface like sources and hydro\_\-data Also, eventually have to think out channel network. \item\end{CompactList}\item 
subroutine \hyperlink{a00026_3785ecc18bdbada28d0be139c7839690}{update\_\-conservative} (mass, mass\_\-prev, div\_\-flux, source\_\-prev, area, ncell, nvar, dt, dx)
\begin{CompactList}\small\item\em Update the conservative variables using divergence of fluxes and integrate the source term using Huen's method. \item\end{CompactList}\end{CompactItemize}


\subsection{Detailed Description}
Module orchestrating the \hyperlink{a00026}{advection} scheme. The main routine in the module is advection(). 



\subsection{Function/Subroutine Documentation}
\hypertarget{a00026_4dbccca3daf30ad5f7c82915361a78f7}{
\index{advection@{advection}!advect@{advect}}
\index{advect@{advect}!advection@{advection}}
\subsubsection[{advect}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.advect (real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em mass}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em mass\_\-prev}, \/  real(STM\_\-REAL),dimension   (ncell,nvar),intent(in) {\em flow}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flow\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flow\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em area}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em area\_\-prev}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em area\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em area\_\-hi}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar}, \/  real(STM\_\-REAL),intent(in) {\em time}, \/  real(STM\_\-REAL),intent(in) {\em dt}, \/  real(STM\_\-REAL),intent(in) {\em dx})}}
\label{a00026_4dbccca3daf30ad5f7c82915361a78f7}


Integrate \hyperlink{a00026}{advection} plus sources for a time step. The final argument to advect is a callback for computing the source term, which should conform to the \hyperlink{a00036}{source\_\-if} interface The algoritm looks like this:\begin{itemize}
\item Convert to primitive variables\item Extrapolate to faces\begin{itemize}
\item difference()\item limiter()\item \hyperlink{a00026_36ba824cb5dc6ca6127866376d2e79ec}{extrapolate()}\end{itemize}
\item upwind()\item \hyperlink{a00026_3947a8a29b1c666b2d1b7223215e9873}{compute\_\-flux()}\item \hyperlink{a00026_ce0b27ec0ac171c15a919d07fb3b32c3}{replace\_\-boundary\_\-flux()} for boundary and special cases\item Compute conservative divergence\item Apply divergence in conservative\_\-update along with Huen's method for sources Note that all these steps are operations on entire arrays of values -- this keeps things efficient. \end{itemize}


\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em mass}]mass at new time\item[{\em mass\_\-prev}]mass at old time\item[{\em flow}]cell-centered flow, old time\item[{\em flow\_\-lo}]flow on lo side of cells centered in time\item[{\em flow\_\-hi}]flow on hi side of cells centered in time\item[{\em area}]cell-centered area at new time\item[{\em area\_\-prev}]cell-centered area at old time??\item[{\em area\_\-lo}]lo side area centered in time\item[{\em area\_\-hi}]hi side area centered in time\item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables\item[{\em time}]current time\item[{\em dt}]current time step\item[{\em dx}]spatial step \end{description}
\end{Desc}
\hypertarget{a00026_aa34a3af6ce02dba4b6a11c1b38f51f0}{
\index{advection@{advection}!compute\_\-divergence@{compute\_\-divergence}}
\index{compute\_\-divergence@{compute\_\-divergence}!advection@{advection}}
\subsubsection[{compute\_\-divergence}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.compute\_\-divergence (real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em div\_\-flux}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flux\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flux\_\-hi}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar})}}
\label{a00026_aa34a3af6ce02dba4b6a11c1b38f51f0}


Compute the divergence of fluxes. At present, this is undivided...which may be not what we want. 

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em div\_\-flux}]cell centered flux divergence, time centered\item[{\em flux\_\-lo}]flux on lo side of cell, time centered\item[{\em flux\_\-hi}]flux on hi side of cell, time centered \item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables \end{description}
\end{Desc}
\hypertarget{a00026_3947a8a29b1c666b2d1b7223215e9873}{
\index{advection@{advection}!compute\_\-flux@{compute\_\-flux}}
\index{compute\_\-flux@{compute\_\-flux}!advection@{advection}}
\subsubsection[{compute\_\-flux}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.compute\_\-flux (real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em flux\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em flux\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em conc\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em conc\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell),intent(in) {\em flow\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell),intent(in) {\em flow\_\-hi}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar})}}
\label{a00026_3947a8a29b1c666b2d1b7223215e9873}


Compute the upwinded fluxes The calculation here does not include tributaries, boundaries or special objects. 

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em flux\_\-lo}]Flux on lo face at half time\item[{\em flux\_\-hi}]Flux on hi face at half time\item[{\em conc\_\-lo}]upwinded conc at half time at lo face\item[{\em conc\_\-hi}]upwinded conc at half time at hi face\item[{\em flow\_\-lo}]time-centered flow at lo face\item[{\em flow\_\-hi}]time-centered flow at hi face\item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables \end{description}
\end{Desc}
\hypertarget{a00026_36ba824cb5dc6ca6127866376d2e79ec}{
\index{advection@{advection}!extrapolate@{extrapolate}}
\index{extrapolate@{extrapolate}!advection@{advection}}
\subsubsection[{extrapolate}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.extrapolate (real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em conc\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em conc\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em conc}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em grad}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em source}, \/  real(STM\_\-REAL),dimension(ncell),intent(in) {\em flow}, \/  real(STM\_\-REAL),dimension(ncell),intent(in) {\em area}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar}, \/  real(STM\_\-REAL),intent(in) {\em time}, \/  real(STM\_\-REAL),intent(in) {\em dt}, \/  real(STM\_\-REAL),intent(in) {\em dx})}}
\label{a00026_36ba824cb5dc6ca6127866376d2e79ec}


Extrapolate primitive data from cell center at the old time to cell edges at the half time. The extrapolation is done by a Taylor series in time and space in which an explicit discretization of the PDE is used to represent the time part. 

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em conc\_\-lo}]estimate from this cell extrapolated to lo face at half time\item[{\em conc\_\-hi}]estimate from this cell extrapolated to hi face at half time\item[{\em conc}]cell centered conc at old time\item[{\em grad}]cell centered \hyperlink{a00033}{gradient} of conc at old time, currently assuming these are undivided differences\item[{\em source}]source terms at old time\item[{\em flow}]cell-centered flow at old time\item[{\em area}]cell-centered area at old time\item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables\item[{\em time}]time\item[{\em dt}]length of current time step being advanced\item[{\em dx}]spatial step \end{description}
\end{Desc}
\hypertarget{a00026_ce0b27ec0ac171c15a919d07fb3b32c3}{
\index{advection@{advection}!replace\_\-boundary\_\-flux@{replace\_\-boundary\_\-flux}}
\index{replace\_\-boundary\_\-flux@{replace\_\-boundary\_\-flux}!advection@{advection}}
\subsubsection[{replace\_\-boundary\_\-flux}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.replace\_\-boundary\_\-flux (real(STM\_\-REAL),dimension(ncell,nvar),intent(inout) {\em flux\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(inout) {\em flux\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em conc\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em conc\_\-hi}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flow\_\-lo}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em flow\_\-hi}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar}, \/  real(STM\_\-REAL),intent(in) {\em time}, \/  real(STM\_\-REAL),intent(in) {\em dt}, \/  real(STM\_\-REAL),intent(in) {\em dx})}}
\label{a00026_ce0b27ec0ac171c15a919d07fb3b32c3}


Replace original calculated flux at boundary locations todo: figure out if the arguments are right and move this routine to the application -- it should just be an interface like sources and hydro\_\-data Also, eventually have to think out channel network. 

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em flux\_\-lo}]Flux on lo face at half time\item[{\em flux\_\-hi}]Flux on hi face at half time\item[{\em conc\_\-lo}]upwinded concentration at half time at lo face\item[{\em conc\_\-hi}]upwinded concentration at half time at hi face\item[{\em flow\_\-lo}]time-centered flow at lo face\item[{\em flow\_\-hi}]time-centered flow at hi face\item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables\item[{\em time}]time\item[{\em dt}]length of current time step\item[{\em dx}]spatial step \end{description}
\end{Desc}
\hypertarget{a00026_3785ecc18bdbada28d0be139c7839690}{
\index{advection@{advection}!update\_\-conservative@{update\_\-conservative}}
\index{update\_\-conservative@{update\_\-conservative}!advection@{advection}}
\subsubsection[{update\_\-conservative}]{\setlength{\rightskip}{0pt plus 5cm}subroutine advection.update\_\-conservative (real(STM\_\-REAL),dimension(ncell,nvar),intent(out) {\em mass}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em mass\_\-prev}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em div\_\-flux}, \/  real(STM\_\-REAL),dimension(ncell,nvar),intent(in) {\em source\_\-prev}, \/  real(STM\_\-REAL),dimension(ncell),intent(in) {\em area}, \/  integer,intent(in) {\em ncell}, \/  integer,intent(in) {\em nvar}, \/  real(STM\_\-REAL),intent(in) {\em dt}, \/  real(STM\_\-REAL),intent(in) {\em dx})}}
\label{a00026_3785ecc18bdbada28d0be139c7839690}


Update the conservative variables using divergence of fluxes and integrate the source term using Huen's method. 

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em mass}]update of mass\item[{\em mass\_\-prev}]old time mass\item[{\em div\_\-flux}]flux divergence, time centered\item[{\em source\_\-prev}]old time source term\item[{\em area}]area of cells\item[{\em ncell}]Number of cells\item[{\em nvar}]Number of variables\item[{\em dt}]length of current time step\item[{\em dx}]spatial step \end{description}
\end{Desc}
